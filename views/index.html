<!-- <link rel="stylesheet" href="static/css/canva.css"> -->
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

<div id="player"></div>
<div/>



<div class="row">
    <div class="column">
        <input id="input" type="text" />
        <button onclick="send()">Send</button>
        <pre id="output"></pre>
    </div>
    <div class="column">
        <input id="query" value='cats' type="text"/>
        <button onclick="search()">Search</button>
        <pre id="response"></pre>
    </div>
</div>


<div class="container" id="app"></div>

<script>
    // Global var that has the information about the video
    var youtubeVideoId = 'BPkZ7xr7qJ0';
    var input = document.getElementById("input");
    var output = document.getElementById("output");
    var hostname = window.location.hostname
    var port = window.location.port
    var socket = new WebSocket("ws://" + hostname + ":" + port + "/echo");

    socket.onopen = function () {
        output.innerHTML += "Status: Connected\n";
    };

    socket.onmessage = function (e) {
        if (e.data.includes('videoId')) {
            obj = JSON.parse(e.data)
            output.innerHTML += "This is the json with video id: " + obj.videoId + " \n";
            if (obj.videoId == youtubeVideoId) {
                output.innerHTML += "Nothing to do as the video playing is the same than video received\n";
            }
            else {
                youtubeVideoId = obj.videoId;
                changeVideo(youtubeVideoId);
            }
        }
        else if (e.data.includes('playerState')) {
            obj = JSON.parse(e.data);
            if (obj.playerState == YT.PlayerState.PLAYING) {
                player.playVideo();
            }
            if (obj.playerState == YT.PlayerState.PAUSED) {
                player.pauseVideo();
            }
        }

        output.innerHTML += "Server: " + e.data + "\n";
    };

    function send() {
        socket.send(input.value);
        input.value = "";
    }

    function requestMaster() {
        socket.send('masterRequest')
    }


    function changeVideo(youtubeVideoId) {
        socket.send('{"videoId": "' + youtubeVideoId + '"}')
        player.loadVideoById(youtubeVideoId);
        player.playVideo()
    }

</script>
<script src="static/js/youtube.js" type="text/javascript"></script>
<script src="https://apis.google.com/js/client.js?onload=onClientLoad" type="text/javascript"></script>
<script type="text/babel" src="static/js/app.jsx"></script>